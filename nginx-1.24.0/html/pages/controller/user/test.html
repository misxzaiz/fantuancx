<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../../../static/css/element.css"/>
    <script src="../../../static/js/vue@3.js"></script>
    <script src="../../../static/js/element-plus.js"></script>
    <script src="../../../static/js/axios.min.js"></script>
    <script src="../../../global.js"></script>

    <style>
        .table {
            width: 100%;
            height: 250px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div v-for="user in users">
            <div>{{user.id}}</div>
            <div>{{user.username}}</div>
            <div>{{user.password}}</div>
            <div>{{user.phone}}</div>
            <div>{{user.email}}</div>
            <div>{{user.avatar}}</div>
            <div>{{user.createdAt}}</div>
            <div>{{user.updatedAt}}</div>
        </div>
        <el-table :data="users" class="table">
            <el-table-column fixed prop="id" label="ID"></el-table-column>
            <el-table-column prop="username" label="用户名"></el-table-column>
            <el-table-column prop="password" label="密码" show-overflow-tooltip></el-table-column>
            <el-table-column prop="phone" label="电话"></el-table-column>
            <el-table-column prop="email" label="邮箱"></el-table-column>
            <el-table-column prop="avatar" label="头像">
                <template slot-scope="scope">
                    <img v-if="scope.row.avatar" :src="scope.row.avatar" style="width: 50px; height: 50px;">
                    <span v-else>无</span>
                </template>
            </el-table-column>
            <el-table-column prop="createdAt" label="创建时间"></el-table-column>
            <el-table-column prop="updatedAt" label="更新时间"></el-table-column>
            <el-table-column label="操作">
                <template slot-scope="scope">
                    <el-button type="primary" icon="el-icon-edit" @click="editUser(scope.row)">编辑</el-button>
                </template>
            </el-table-column>
            
        </el-table>{{users}}
        <el-dialog :visible.sync="dialogVisible" :title="dialogTitle" :destroy-on-close="true">
            <el-form ref="userForm" :model="userForm" label-width="100px">
                <el-form-item label="ID">
                    <el-input v-model="userForm.id" readonly></el-input>
                </el-form-item>
                <el-form-item label="用户名">
                    <el-input v-model="userForm.username"></el-input>
                </el-form-item>
                <el-form-item label="密码">
                    <el-input v-model="userForm.password"></el-input>
                </el-form-item>
                <el-form-item label="电话">
                    <el-input v-model="userForm.phone"></el-input>
                </el-form-item>
                <el-form-item label="邮箱">
                    <el-input v-model="userForm.email"></el-input>
                </el-form-item>
                <el-form-item label="头像">
                    <el-input v-model="userForm.avatar"></el-input>
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @click="dialogVisible = false">取 消</el-button>
                <el-button type="primary" @click="saveUser()">确 定</el-button>
            </div>
        </el-dialog>
    </div>

    <script>
        const App = {
            data() {
                return {
                    users: [ { "id": 1, "username": "Alice", "password": "123456", "phone": "13333333333", "email": "alice@example.com", "avatar": "https://example.com/avatar1.jpg", "createdAt": "2023-05-14T12:42:19.000+00:00", "updatedAt": "2023-05-14T12:42:19.000+00:00" }, { "id": 2, "username": "Bob", "password": "654321", "phone": "18888888888", "email": "bob@example.com", "avatar": "https://example.com/avatar2.jpg", "createdAt": "2023-05-14T12:42:19.000+00:00", "updatedAt": "2023-05-14T12:42:19.000+00:00" }, { "id": 3, "username": "Charlie", "password": "abcdef", "phone": "19999999999", "email": "charlie@example.com", "avatar": null, "createdAt": "2023-05-14T12:42:19.000+00:00", "updatedAt": "2023-05-14T12:42:19.000+00:00" }, { "id": 4, "username": "David", "password": "fedcba", "phone": null, "email": "david@example.com", "avatar": "https://example.com/avatar4.jpg", "createdAt": "2023-05-14T12:42:19.000+00:00", "updatedAt": "2023-05-14T12:42:19.000+00:00" }],
                    dialogVisible: false,
                    dialogTitle: '',
                    userForm: {},
                }
            },
            mounted() {  
                // 禁止直接跳转
                const token = localStorage.getItem('token');
                if(token==='null' || token === null){
                    window.location.href='../../login/index.html';
                }
                axios.get(window.uri+'/user',{
                    headers: {
                        'Authorization': `${token}`
                    }
                })
                .then(res => {
                    this.users = res.data.data
                    console.log(res.data.data)
                })
            },
            methods: {
                editUser(row) {
                    // 弹出编辑框，并设置表单数据
                    this.dialogVisible = true;
                    this.dialogTitle = '编辑用户信息';
                    this.userForm = Object.assign({}, row);
                },
                saveUser() {
                    // 提交表单数据，并更新用户信息
                    const url = window.uri + '/user/' + this.userForm.id;
                    const token = localStorage.getItem('token');
                    axios.put(url, this.userForm, {
                        headers: {
                            'Authorization': `${token}`
                        }
                    })
                    .then(res => {
                        this.dialogVisible = false;
                        const index = this.users.findIndex(item => item.id === this.userForm.id);
                        this.users.splice(index, 1, res.data.data);
                    })
                }
            }
        };
        const app = Vue.createApp(App);
        app.use(ElementPlus);
        app.mount("#app")
    </script>
</body>
</html>
